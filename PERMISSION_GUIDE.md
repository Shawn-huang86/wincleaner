# WinCleaner 权限管理指南

## 🔒 权限概述

WinCleaner 在扫描和清理文件时需要适当的权限来访问系统文件和文件夹。本指南详细说明了应用程序的权限机制、访问限制和安全策略。

## 📋 当前权限配置

### 管理员权限
- **状态**: ✅ 已配置
- **配置**: `"requestedExecutionLevel": "requireAdministrator"`
- **说明**: 应用启动时会请求管理员权限，这是为了能够访问系统临时文件夹和执行清理操作

### 权限级别
```
用户权限 < 管理员权限 < 系统权限 < 内核权限
         ↑
    WinCleaner 当前级别
```

## 🛡️ 安全策略

### 1. 三级权限控制

#### 🚫 **禁止访问区域** (Forbidden)
这些路径绝对不会被访问或修改：

```
C:\Windows\System32\          # 系统核心文件
C:\Windows\SysWOW64\          # 32位系统文件
C:\Windows\Boot\              # 启动文件
C:\Windows\Recovery\          # 系统恢复
C:\Windows\WinSxS\            # 系统组件存储
C:\Program Files\Windows Defender\  # 安全软件
C:\Boot\                      # 引导分区
C:\Recovery\                  # 恢复分区
```

#### ⚠️ **受限访问区域** (Restricted)
这些路径可以访问，但会格外谨慎：

```
C:\Program Files\             # 程序安装目录
C:\Program Files (x86)\       # 32位程序目录
C:\ProgramData\               # 程序共享数据
C:\Windows\                   # Windows目录（部分）
C:\Users\All Users\           # 所有用户数据
C:\Users\Default\             # 默认用户配置
```

#### ✅ **安全访问区域** (Safe)
这些路径被认为是安全的，可以正常扫描和清理：

```
C:\Windows\Temp\              # 系统临时文件
C:\Windows\Logs\              # 系统日志
C:\Windows\Prefetch\          # 预读取文件
C:\Windows\SoftwareDistribution\Download\  # 更新下载
C:\Temp\                      # 临时目录
C:\Users\[用户名]\AppData\Local\Temp\     # 用户临时文件
C:\Users\[用户名]\AppData\Local\Microsoft\Windows\INetCache\  # IE缓存
```

### 2. 文件类型保护

#### 绝对不会删除的文件
```
ntldr, bootmgr, boot.ini      # 启动文件
pagefile.sys, hiberfil.sys    # 系统文件
system.dat, user.dat          # 注册表文件
autoexec.bat, config.sys      # 系统配置
```

#### 需要确认的文件
```
.exe, .dll (在系统目录中)     # 可执行文件
.sys, .drv                    # 驱动文件
.reg                          # 注册表文件
```

## 🔍 实际访问能力分析

### ✅ **可以访问的内容**

1. **用户文件夹**
   - 个人文档、下载、桌面等
   - 浏览器缓存和临时文件
   - 应用程序数据文件夹

2. **系统临时文件**
   - Windows临时文件夹
   - 系统日志文件
   - 更新下载缓存

3. **应用程序数据**
   - 已安装程序的缓存
   - 日志文件
   - 临时数据

### ❌ **无法访问的内容**

1. **系统保护文件**
   - 被Windows文件保护的核心文件
   - 正在运行的系统进程文件
   - 内核级别的文件

2. **加密文件**
   - EFS加密的用户文件
   - BitLocker加密的驱动器内容
   - 其他用户的加密文件

3. **网络资源**
   - 需要特殊凭据的网络驱动器
   - 远程计算机上的文件
   - 云存储同步文件（如果被锁定）

4. **虚拟化文件系统**
   - 容器内的文件系统
   - 虚拟机的虚拟磁盘
   - 沙盒环境的文件

## 🛠️ 权限检查工具

### 使用内置权限检查器

1. 打开 WinCleaner
2. 点击设置按钮 ⚙️
3. 找到"权限和安全"部分
4. 点击"检查权限状态"
5. 查看详细的权限报告

### 权限测试功能

权限检查器提供了测试功能：
- **临时文件读取测试**: 验证是否可以访问临时文件
- **系统文件保护测试**: 确认系统文件被正确保护

## 🚨 安全保障机制

### 1. 多重验证
```
文件操作请求 → 路径检查 → 文件类型检查 → AI安全分析 → 用户确认 → 执行操作
```

### 2. 回收站保护
- 所有删除操作都会将文件移动到回收站
- 不会执行永久删除操作
- 用户可以随时恢复误删的文件

### 3. 操作日志
- 记录所有文件操作
- 可以追踪操作历史
- 便于问题排查和恢复

### 4. 用户确认机制
- 高风险操作需要用户明确确认
- 显示详细的操作说明和风险提示
- 提供取消操作的选项

## 📊 权限限制对功能的影响

### 扫描功能
- **✅ 可以扫描**: 用户文件夹、临时目录、缓存文件夹
- **⚠️ 部分扫描**: 程序安装目录（只读取，不修改）
- **❌ 无法扫描**: 系统核心目录、其他用户的加密文件

### 清理功能
- **✅ 可以清理**: 临时文件、缓存文件、日志文件
- **⚠️ 需要确认**: 程序数据文件、用户文档
- **❌ 禁止清理**: 系统文件、正在使用的文件

### 应用管理
- **✅ 可以查看**: 所有已安装的应用程序信息
- **⚠️ 需要确认**: 卸载用户安装的应用
- **❌ 禁止操作**: 系统关键组件和服务

## 🔧 权限问题排查

### 常见问题

#### 1. "访问被拒绝"错误
**原因**: 
- 文件被其他程序占用
- 权限不足
- 文件被系统保护

**解决方案**:
- 关闭占用文件的程序
- 以管理员身份重新运行
- 检查文件是否为系统保护文件

#### 2. 扫描结果不完整
**原因**:
- 某些目录访问受限
- 网络驱动器连接问题
- 权限配置问题

**解决方案**:
- 检查权限状态
- 确认网络连接
- 重新以管理员身份运行

#### 3. 无法删除某些文件
**原因**:
- 文件正在使用中
- 文件被标记为只读
- 权限不足

**解决方案**:
- 结束相关进程
- 修改文件属性
- 检查权限设置

## 📈 权限优化建议

### 1. 运行环境优化
- 始终以管理员身份运行
- 关闭不必要的安全软件干扰
- 确保系统权限配置正确

### 2. 扫描策略优化
- 优先扫描安全区域
- 避免扫描系统关键目录
- 使用增量扫描减少重复操作

### 3. 安全设置优化
- 启用AI智能分析
- 配置适当的风险阈值
- 定期检查权限状态

## 🔮 未来改进计划

### 1. 权限管理增强
- 更细粒度的权限控制
- 动态权限调整
- 权限使用统计

### 2. 安全机制完善
- 更智能的文件识别
- 增强的用户确认机制
- 更详细的操作日志

### 3. 用户体验优化
- 更直观的权限状态显示
- 简化的权限配置流程
- 更好的错误提示和解决建议

---

通过合理的权限管理和安全策略，WinCleaner 能够在保证系统安全的前提下，为用户提供有效的文件清理服务。如果您遇到权限相关的问题，请参考本指南或联系技术支持。
